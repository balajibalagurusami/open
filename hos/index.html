<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CTC & Take-Home Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg: #f4f4f5;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --accent: #2563eb;
      --border: #e5e7eb;
    }

    body.dark {
      --bg: #020617;
      --card: #0b1220;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --accent: #38bdf8;
      --border: #1f2937;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.75rem 1rem;
      border-bottom: 1px solid var(--border);
      background: var(--card);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .topbar h1 {
      font-size: 1rem;
      margin: 0;
    }

    #themeToggle {
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
      padding: 0.35rem 0.7rem;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.8rem;
    }

    main {
      max-width: 640px;
      margin: 1rem auto 2rem;
      padding: 0 1rem;
    }

    .card {
      background: var(--card);
      border-radius: 0.75rem;
      padding: 1rem;
      margin-bottom: 1rem;
      border: 1px solid var(--border);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
    }

    .card h2 {
      margin-top: 0;
      font-size: 1rem;
      margin-bottom: 0.5rem;
    }

    label {
      display: block;
      font-size: 0.85rem;
      color: var(--muted);
      margin-top: 0.5rem;
    }

    input {
      width: 100%;
      padding: 0.45rem 0.6rem;
      margin-top: 0.2rem;
      border-radius: 0.5rem;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text);
    }

    input:focus {
      outline: 2px solid var(--accent);
      outline-offset: 1px;
      border-color: transparent;
    }

    #calcBtn {
      width: 100%;
      padding: 0.7rem;
      border-radius: 999px;
      border: none;
      background: var(--accent);
      color: #f9fafb;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 1rem;
    }

    #calcBtn:hover {
      opacity: 0.95;
    }

    #result b {
      display: inline-block;
      min-width: 180px;
      font-size: 0.88rem;
    }

    #result br {
      line-height: 1.6;
    }

    .note {
      font-size: 0.75rem;
      color: var(--muted);
      margin-top: 0.5rem;
      margin-bottom: 0;
    }

    canvas {
      width: 100%;
      max-width: 100%;
      border-radius: 0.5rem;
      border: 1px dashed var(--border);
      background: rgba(15, 23, 42, 0.02);
    }
  </style>
</head>
<body>
  <header class="topbar">
    <h1>CTC & Take-Home Calculator</h1>
    <button id="themeToggle" type="button">ðŸŒ™ Dark</button>
  </header>

  <main>
    <section class="card">
      <h2>Income Details</h2>

      <label>Current CTC (Annual - â‚¹)</label>
      <input id="ctc" type="number" step="1000" value="2318000">

      <label>Expected Hike (%)</label>
      <input id="hike" type="number" step="1" value="30">
    </section>

    <section class="card">
      <h2>Monthly Expenses</h2>

      <label>Rent (â‚¹)</label>
      <input id="rent" type="number" value="0">

      <label>Food (â‚¹)</label>
      <input id="food" type="number" value="0">

      <label>Air Travel (â‚¹)</label>
      <input id="air" type="number" value="0">

      <label>Daily Commute (â‚¹)</label>
      <input id="commute" type="number" value="0">

      <label>Electricity (â‚¹)</label>
      <input id="electricity" type="number" value="0">

      <label>Internet (â‚¹)</label>
      <input id="internet" type="number" value="0">

      <label>EMI (â‚¹)</label>
      <input id="emi" type="number" value="0">
    </section>

    <button id="calcBtn" type="button" onclick="calc()">Calculate</button>

    <section class="card" id="result"></section>

    <section class="card">
      <h2>Monthly Snapshot</h2>
      <canvas id="chart" width="400" height="220"></canvas>
      <p class="note">Bars show Take-home vs Expenses vs Savings.</p>
    </section>
  </main>

  <script>
    // ---- Defaults ----
    const DEFAULTS = {
      ctc: 0,
      hike: .,
      rent: 0,
      food: 0,
      air: 0,
      commute: 0,
      electricity: 0,
      internet: 0,
      emi: 0
    };

    const LS_KEY_VALUES = "ctc_calc_values_v1";
    const LS_KEY_THEME = "ctc_calc_theme_v1";

    // ---- Tax - New Regime 2025 (approx slabs) ----
    function taxNewRegime2025(income) {
      let tax = 0;
      const slabs = [
        [0, 400000, 0],
        [400000, 800000, 0.05],
        [800000, 1200000, 0.10],
        [1200000, 1600000, 0.15],
        [1600000, 2000000, 0.20],
        [2000000, Infinity, 0.30]
      ];

      for (const [low, high, rate] of slabs) {
        if (income > low) {
          const taxable = Math.min(income, high) - low;
          tax += taxable * rate;
        }
      }
      return tax;
    }

    // ---- Load / Save values ----
    function loadValues() {
      let stored = null;
      try {
        stored = JSON.parse(localStorage.getItem(LS_KEY_VALUES) || "null");
      } catch (e) {
        stored = null;
      }

      const vals = stored || DEFAULTS;

      for (const key of Object.keys(DEFAULTS)) {
        const el = document.getElementById(key);
        if (el) el.value = vals[key];
      }
    }

    function saveValues() {
      const vals = {};
      for (const key of Object.keys(DEFAULTS)) {
        const el = document.getElementById(key);
        vals[key] = el ? Number(el.value || 0) : 0;
      }
      localStorage.setItem(LS_KEY_VALUES, JSON.stringify(vals));
    }

    // ---- Theme handling ----
    function initTheme() {
      const saved = localStorage.getItem(LS_KEY_THEME);
      const prefersDark =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;
      const useDark = saved === "dark" || (!saved && prefersDark);

      document.body.classList.toggle("dark", useDark);

      const btn = document.getElementById("themeToggle");
      if (btn) btn.textContent = useDark ? "â˜€ï¸ Light" : "ðŸŒ™ Dark";

      if (btn) {
        btn.onclick = function () {
          toggleTheme();
        };
      }
    }

    function toggleTheme() {
      const isDark = document.body.classList.toggle("dark");
      localStorage.setItem(LS_KEY_THEME, isDark ? "dark" : "light");
      const btn = document.getElementById("themeToggle");
      if (btn) btn.textContent = isDark ? "â˜€ï¸ Light" : "ðŸŒ™ Dark";
    }

    // ---- Chart ----
    function drawChart(takeHomeMonthly, expenses, savings) {
      const canvas = document.getElementById("chart");
      if (!canvas || !canvas.getContext) return;
      const ctx = canvas.getContext("2d");

      const w = canvas.width;
      const h = canvas.height;
      ctx.clearRect(0, 0, w, h);

      const labels = ["Take-home", "Expenses", "Savings"];
      const values = [takeHomeMonthly, expenses, savings];

      const maxVal = Math.max(1, ...values.map(v => Math.abs(v)));
      const padding = 20;
      const barWidth = (w - padding * 2) / (labels.length * 1.5);
      const baseline = h - 30;

      // Axis
      ctx.strokeStyle = "#9ca3af";
      ctx.beginPath();
      ctx.moveTo(padding, baseline);
      ctx.lineTo(w - padding, baseline);
      ctx.stroke();

      // Bars
      labels.forEach((label, idx) => {
        const val = values[idx];
        const ratio = val / maxVal;
        const barHeight = ratio * (h - 70);
        const x = padding + idx * (barWidth * 1.5) + barWidth * 0.25;
        const y = baseline - barHeight;

        ctx.fillStyle = idx === 0 ? "#22c55e" : idx === 1 ? "#ef4444" : "#3b82f6";
        ctx.fillRect(x, y, barWidth, barHeight);

        ctx.fillStyle = "#6b7280";
        ctx.font = "10px system-ui";
        ctx.textAlign = "center";
        ctx.fillText(label, x + barWidth / 2, baseline + 12);

        ctx.fillText(
          "â‚¹" + Math.round(val).toLocaleString(),
          x + barWidth / 2,
          y - 4
        );
      });
    }

    // ---- Main calc ----
    function calc() {
      const currentCTC = Number(document.getElementById("ctc").value || 0);
      const hikePct = Number(document.getElementById("hike").value || 0);

      if (!currentCTC || currentCTC <= 0) {
        document.getElementById("result").innerHTML =
          "<b>Enter a valid Current CTC.</b>";
        return;
      }

      const newCTC = currentCTC * (1 + hikePct / 100);
      const gainAnnual = newCTC - currentCTC;
      const gainMonthly = gainAnnual / 12;

      // Basic = 40 percent of CTC
      const basic = newCTC * 0.40;

      // PF contributions
      const pfEmployeeAnnual = basic * 0.12;  // leaves your salary
      const pfEmployerAnnual = basic * 0.12;  // remains in CTC
      const pfTotal = pfEmployeeAnnual + pfEmployerAnnual;

      // Tax on (CTC - employer PF)
      const taxableIncome = newCTC - pfEmployerAnnual;
      const tax = taxNewRegime2025(taxableIncome);

      const takeHomeAnnual = newCTC - tax - pfEmployeeAnnual;
      const takeHomeMonthly = takeHomeAnnual / 12;

      // Monthly expenses
      const rent = Number(document.getElementById("rent").value || 0);
      const food = Number(document.getElementById("food").value || 0);
      const air = Number(document.getElementById("air").value || 0);
      const commute = Number(document.getElementById("commute").value || 0);
      const electricity = Number(document.getElementById("electricity").value || 0);
      const internet = Number(document.getElementById("internet").value || 0);
      const emi = Number(document.getElementById("emi").value || 0);

      const expenses = rent + food + air + commute + electricity + internet + emi;
      const savings = takeHomeMonthly - expenses;

      document.getElementById("result").innerHTML = `
        <h2>Results</h2>
        <b>Current CTC:</b> â‚¹${currentCTC.toLocaleString()} <br>
        <b>New CTC:</b> â‚¹${newCTC.toLocaleString()} <br><br>

        <b>Annual Gain:</b> â‚¹${gainAnnual.toLocaleString()} <br>
        <b>Monthly Gain:</b> â‚¹${gainMonthly.toLocaleString()} <br><br>

        <b>Basic (40 percent):</b> â‚¹${basic.toLocaleString()} <br>
        <b>PF Employee (12 percent):</b> â‚¹${pfEmployeeAnnual.toLocaleString()} <br>
        <b>PF Employer (12 percent):</b> â‚¹${pfEmployerAnnual.toLocaleString()} <br>
        <b>Total PF (24 percent):</b> â‚¹${pfTotal.toLocaleString()} <br><br>

        <b>Taxable Income:</b> â‚¹${taxableIncome.toLocaleString()} <br>
        <b>Income Tax (Annual):</b> â‚¹${tax.toLocaleString()} <br>
        <b>Take-Home (Annual):</b> â‚¹${takeHomeAnnual.toLocaleString()} <br>
        <b>Take-Home (Monthly):</b> â‚¹${takeHomeMonthly.toLocaleString()} <br><br>

        <b>Total Monthly Expenses:</b> â‚¹${expenses.toLocaleString()} <br>
        <b>Monthly Savings:</b>
        <span style="color:${savings >= 0 ? "green" : "red"}">
          â‚¹${savings.toLocaleString()}
        </span>
      `;

      drawChart(takeHomeMonthly, expenses, savings);
      saveValues();
    }

    // ---- Init (DOM is ready because script is at the end) ----
    loadValues();
    initTheme();
    calc();
  </script>
</body>
</html>
